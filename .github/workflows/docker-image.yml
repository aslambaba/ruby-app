name: Rails App Pipeline with Docker-Compose

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Make ENV File
      run: |
        touch .env
        echo "DB_USER=${{ secrets.APP_ENV_USER }}
        DB_PASSWORD=${{ secrets.APP_ENV_PASS }}
        REDIS_URL=${{ secrets.APP_ENV_REDISURL }}
        REDIS_PASSWORD=${{ secrets.APP_ENV_REDISPASS }}
        DO_REGISTRY_URL=${{ secrets.APP_ENV_DO_REG_PASS }}" >> .env
        pwd
        ls
        ls ~/
    - name: Pass Docker-Compose File to DO
      run: |
        sudo apt-get install sshpass -y
        sshpass -p ${{ secrets.DO_PASSWORD }} scp docker-compose.yml ${{ secrets.DO_USER }}@${{secrets.DO_HOST}}:~/
